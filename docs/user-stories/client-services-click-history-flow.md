# User Story: –ò—Å—Ç–æ—Ä–∏—è –∫–ª–∏–∫–æ–≤ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º (Client Services Click History Flow)

## üìã –û–ø–∏—Å–∞–Ω–∏–µ
**–ö–∞–∫** –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç  
**–Ø —Ö–æ—á—É** –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–°–≤—è–∑–∞—Ç—å—Å—è" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–µ—Ä–≤–∏—Å–∞ –∏ —É–≤–∏–¥–µ—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç—ã  
**–ß—Ç–æ–±—ã** —Å–≤—è–∑–∞—Ç—å—Å—è —Å –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–º —É—Å–ª—É–≥–∏, –∞ —Ç–∞–∫–∂–µ —á—Ç–æ–±—ã —ç—Ç–æ—Ç —Ñ–∞–∫—Ç —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è –≤ –∏—Å—Ç–æ—Ä–∏–∏ –º–æ–∏—Ö –∑–∞–∫–∞–∑–æ–≤

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏
- [x] –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–µ—Ä–≤–∏—Å–∞ –≤–∏–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–°–≤—è–∑–∞—Ç—å—Å—è" (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–Ω–∏–∑—É, –≤—ã—à–µ `Navbar`)
- [x] –ü–æ –∫–ª–∏–∫—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ –∏–∑ `tcontacts`
- [x] –í –ë–î —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ `tservices_clicks` (—É–Ω–∏–∫–∞–ª—å–Ω–∞—è –Ω–∞ –ø–∞—Ä—É `(tclients_id, tservices_id)`)
- [x] –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç –∑–∞–ø–∏—Å–∏
- [x] –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 401 –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/telegram-auth`)
- [x] –í —Ä–∞–∑–¥–µ–ª–µ –ø—Ä–æ—Ñ–∏–ª—è "–ú–æ–∏ –∑–∞–∫–∞–∑—ã" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –±—ã–ª–∏ –∫–ª–∏–∫–∏, —Å –¥–∞—Ç–æ–π –∫–ª–∏–∫–∞
- [x] –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ API –≤—ã–∑–æ–≤–∞ –∫–ª–∏–µ–Ω—Ç–æ–º

## üîÑ –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å

### –®–∞–≥ 1: –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å–µ—Ä–≤–∏—Å–∞
**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å–µ—Ä–≤–∏—Å–∞ `/services/[serviceId]`  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `src/app/services/[serviceId]/page.tsx`
- `src/service/ServiceService.ts`
- `src/repository/ServiceRepository.ts`

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –°–µ—Ä–≤–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Ä–≤–∏—Å–µ (`ServiceTypeFull`) –≤–º–µ—Å—Ç–µ —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ (`tcontacts`)
2. –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–µ + –∫–Ω–æ–ø–∫–∞ "–°–≤—è–∑–∞—Ç—å—Å—è"

### –®–∞–≥ 2: –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–°–≤—è–∑–∞—Ç—å—Å—è"
**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–ª–∏–µ–Ω—Ç –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–°–≤—è–∑–∞—Ç—å—Å—è" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–µ—Ä–≤–∏—Å–∞  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- UI: `src/app/services/[serviceId]/SingleServiceView.tsx`
- API: `src/app/api/services/[serviceId]/click/route.ts`
- –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞: `src/service/ServicesClicksService.ts`
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `src/repository/ServicesClicksRepository.ts`

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `POST /api/services/[serviceId]/click`
2. –°–µ—Ä–≤–µ—Ä –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`getServerUser`)
3. –í —Å–µ—Ä–≤–∏—Å–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –≤ `tservices_clicks` (–∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è)
4. –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∫–æ–Ω—Ç–∞–∫—Ç–∞–º–∏ (`service.contacts`), –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

### –®–∞–≥ 3: –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –∑–∞–∫–∞–∑–æ–≤ (–ø—Ä–æ—Ñ–∏–ª—å)
**–¢—Ä–∏–≥–≥–µ—Ä:** –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ñ–∏–ª—è —Å –∑–∞–∫–∞–∑–∞–º–∏ `/profile/orders`  
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- –°—Ç—Ä–∞–Ω–∏—Ü–∞: `src/app/profile/orders/page.tsx`
- –°–µ—Ä–≤–∏—Å: `src/service/ServicesClicksService.ts`
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: `src/repository/ServicesClicksRepository.ts`
- UI: `src/app/profile/orders/_components/OrdersList.tsx`

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –∫–ª–∏–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`getByClientsId(user.id)`) —Å –æ–±–æ–≥–∞—â–µ–Ω–∏–µ–º –∏–º–µ–Ω–∞–º–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
2. –ù–∞ –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≥–æ—Ç–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –¥–ª—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ (`OrdersList`)
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –∏ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Å–µ—Ä–≤–∏—Å—É

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```typescript
// –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–µ—Ä–≤–∏—Å–∞ + –∫–Ω–æ–ø–∫–∞ "–°–≤—è–∑–∞—Ç—å—Å—è" –∏ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
src/app/services/[serviceId]/page.tsx
src/app/services/[serviceId]/SingleServiceView.tsx

// –ü—Ä–æ—Ñ–∏–ª—å / –ú–æ–∏ –∑–∞–∫–∞–∑—ã: —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
src/app/profile/orders/page.tsx
src/app/profile/orders/_components/OrdersList.tsx
```

### Backend API
```typescript
// –§–∏–∫—Å–∞—Ü–∏—è –∫–ª–∏–∫–∞ –ø–æ —Å–µ—Ä–≤–∏—Å—É
POST /api/services/[serviceId]/click
‚îî‚îÄ‚îÄ –°–æ–∑–¥–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—É—é –∑–∞–ø–∏—Å—å (–∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é) –≤ tservices_clicks
```

### –°–µ—Ä–≤–∏—Å—ã –∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
```typescript
// –°–µ—Ä–≤–∏—Å—ã
src/service/ServiceService.ts                // getServiceById -> ServiceTypeFull —Å contacts
src/service/ServicesClicksService.ts         // createUniqueClick, getByClientsId

// –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
src/repository/ServiceRepository.ts          // findFullById (—Å include tcontacts)
src/repository/ServicesClicksRepository.ts   // createUnique, findByClientId
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
-- –ö–æ–Ω—Ç–∞–∫—Ç—ã —Å–µ—Ä–≤–∏—Å–∞
`tcontacts`
id (PK), tservices_id (FK), email, phone, tg_username, website, whatsap

-- –ò—Å—Ç–æ—Ä–∏—è –∫–ª–∏–∫–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ —Å–µ—Ä–≤–∏—Å–∞–º
`tservices_clicks`
id (PK), tclients_id (FK), tservices_id (FK), timestamp (default now())
UNIQUE (tclients_id, tservices_id)
INDEX (tclients_id)
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
- –ö–Ω–æ–ø–∫–∞ "–°–≤—è–∑–∞—Ç—å—Å—è" —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞–¥ `Navbar` (z-index –≤—ã—à–µ `z-50` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `zIndex: 60`)
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã, —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–µ —Å —Å–µ—Ä–≤–∏—Å–æ–º (`ServiceTypeFull.contacts`)
- –ó–∞–ø–∏—Å—å –∫–ª–∏–∫–∞ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–∞—è: —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ `(tclients_id, tservices_id)`
- –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç 401; UI –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ `/telegram-auth`
- –†–∞–∑–¥–µ–ª –ø—Ä–æ—Ñ–∏–ª—è –≥—Ä—É–∑–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –∑–∞–∫–∞–∑–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –±–µ–∑ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ API-–∑–∞–ø—Ä–æ—Å–∞

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞
- –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ –∫–ª–∏–∫–∞: < 200ms
- –í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: < 100ms
- –î—É–±–ª–∏–∫–∞—Ç—ã –∑–∞–ø–∏—Å–µ–π: 0 (–∑–∞ —Å—á–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞)
- –û—à–∏–±–∫–∏ 401 –ø—Ä–∏ –∫–ª–∏–∫–µ: —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üîÑ –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram ‚Äî —Å–º. `docs/user-stories/telegram-auth-flow.md`

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- MVP: –±–µ–∑ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏/—Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ —Å–ø–∏—Å–∫–µ –∑–∞–∫–∞–∑–æ–≤
- –í UI –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –±–µ–∑ —Å–ª–æ–∂–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ–æ–∫—É—Å–æ–º
- –ö–æ–Ω—Ç–∞–∫—Ç—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ `tcontacts` –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ –µ—Å—Ç—å, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---
**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-08-09  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ 


