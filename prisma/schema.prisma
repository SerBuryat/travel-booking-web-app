generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model tadmins {
  id           Int            @id @default(autoincrement())
  email        String         @unique @db.VarChar(255)
  role         String         @db.VarChar(50)
  created_at   DateTime       @default(now()) @db.Timestamp(6)
  tadmins_auth tadmins_auth[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model tadmins_auth {
  id            Int     @id @default(autoincrement())
  tadmins_id    Int
  auth_type     String  @db.VarChar(20)
  auth_id       String? @db.VarChar(255)
  password_hash String? @db.VarChar(255)
  tadmins       tadmins @relation(fields: [tadmins_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tadmins_id, auth_type])
}

model talerts {
  id            Int        @id @default(autoincrement())
  tbids_id      Int
  tproviders_id Int
  created_at    DateTime   @default(now()) @db.Timestamp(6)
  is_read       Boolean    @default(false)
  tservices_id  Int?
  variables     String?
  is_seen       Boolean?
  tservices     tservices? @relation(fields: [tservices_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_talerts_tservices")
  tbids         tbids      @relation(fields: [tbids_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tproviders    tproviders @relation(fields: [tproviders_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tarea {
  id          Int                   @id @default(autoincrement())
  name        String                @db.VarChar(255)
  sysname     String                @unique @db.VarChar(100)
  parent_id   Int?
  tier        Int                   @db.SmallInt
  path        Unsupported("ltree")?
  created_at  DateTime?             @default(now()) @db.Timestamp(6)
  tarea       tarea?                @relation("tareaTotarea", fields: [parent_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  other_tarea tarea[]               @relation("tareaTotarea")
  tbids       tbids[]
  tclients    tclients[]
  tlocations  tlocations[]

  @@index([path], map: "idx_tarea_path", type: Gist)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tbids {
  id                        Int                         @id @default(autoincrement())
  tclients_id               Int
  tarea_id                  Int
  budget                    Decimal?                    @db.Decimal(12, 2)
  status                    String                      @db.VarChar(20)
  comment                   String?
  created_at                DateTime                    @default(now()) @db.Timestamp(6)
  number                    String?                     @db.VarChar(15)
  tcategories_id            Int?
  is_flexible               Boolean?                    @default(false)
  type                      String                      @db.VarChar(20)
  talerts                   talerts[]
  tarea                     tarea                       @relation(fields: [tarea_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tcategories               tcategories?                @relation(fields: [tcategories_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  tclients                  tclients                    @relation(fields: [tclients_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tbids_accomodation_attrs  tbids_accomodation_attrs[]
  tbids_entertainment_attrs tbids_entertainment_attrs[]
  tbids_food_attrs          tbids_food_attrs[]
  tbids_health_attrs        tbids_health_attrs[]
  tbids_package_attrs       tbids_package_attrs[]
  tbids_transport_attrs     tbids_transport_attrs[]
  tproposals                tproposals[]

  @@index([tarea_id], map: "idx_tbids_area")
  @@index([tcategories_id], map: "idx_tbids_category")
}

model tcategories {
  id                Int                   @id @default(autoincrement())
  code              String                @unique @db.VarChar(50)
  sysname           String                @unique @db.VarChar(100)
  name              String                @db.VarChar(255)
  photo             String?               @db.VarChar(255)
  parent_id         Int?
  path              Unsupported("ltree")?
  tbids             tbids[]
  tcategories       tcategories?          @relation("tcategoriesTotcategories", fields: [parent_id], references: [id], onUpdate: NoAction)
  other_tcategories tcategories[]         @relation("tcategoriesTotcategories")
  tservices         tservices[]

  @@index([path], map: "idx_categories_path", type: Gist)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tclients {
  id                Int                 @id @default(autoincrement())
  tarea_id          Int?
  name              String              @db.VarChar(255)
  email             String?             @unique @db.VarChar(255)
  additional_info   Json?
  created_at        DateTime            @default(now()) @db.Timestamp(6)
  photo             String?             @db.VarChar(500)
  tbids             tbids[]
  tarea             tarea?              @relation(fields: [tarea_id], references: [id], onUpdate: NoAction)
  tclients_auth     tclients_auth[]
  tclients_settings tclients_settings[]
  tproviders        tproviders[]
  treviews          treviews[]
  tservices_clicks  tservices_clicks[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tclients_auth {
  id               Int       @id @default(autoincrement())
  tclients_id      Int
  auth_type        String?   @db.VarChar(20)
  auth_id          String?   @db.VarChar(255)
  last_login       DateTime? @db.Timestamp(6)
  auth_context     Json?
  is_active        Boolean   @default(true)
  refresh_token    String?   @db.VarChar(1000)
  role             String    @default("user") @db.VarChar(20)
  token_expires_at DateTime? @db.Timestamp(6)
  tclients         tclients  @relation(fields: [tclients_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([auth_type, auth_id])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tclients_settings {
  id            Int      @id @default(autoincrement())
  tclients_id   Int
  setting_key   String   @db.VarChar(100)
  setting_value String
  tclients      tclients @relation(fields: [tclients_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tclients_id, setting_key])
}

model tcontacts {
  id           Int       @id @default(autoincrement())
  tservices_id Int
  email        String    @db.VarChar(255)
  phone        String?   @db.VarChar(14)
  tg_username  String?   @db.VarChar(255)
  website      String?   @db.VarChar(255)
  whatsap      String?   @db.VarChar(255)
  tservices    tservices @relation(fields: [tservices_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// Stores unique client clicks on services ("contact" button presses)
model tservices_clicks {
  id           Int       @id @default(autoincrement())
  tclients_id  Int
  tservices_id Int
  timestamp    DateTime  @default(now()) @db.Timestamp(6)
  tclients     tclients  @relation(fields: [tclients_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tservices    tservices @relation(fields: [tservices_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tclients_id, tservices_id], map: "uq_tservices_clicks_client_service")
  @@index([tclients_id], map: "idx_tservices_clicks_client")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tlocations {
  id           Int       @id @default(autoincrement())
  tservices_id Int
  name         String?   @db.VarChar(255)
  address      String
  latitude     Decimal?  @db.Decimal(10, 8)
  longitude    Decimal?  @db.Decimal(11, 8)
  tarea_id     Int
  description  String?
  tarea        tarea     @relation(fields: [tarea_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tservices    tservices @relation(fields: [tservices_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tarea_id], map: "idx_tlocations_area")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tnotifications {
  id           Int       @id @default(autoincrement())
  user_id      Int
  user_role    String    @db.VarChar(10)
  message      String
  is_read      Boolean   @default(false)
  created_at   DateTime  @default(now()) @db.Timestamp(6)
  ttemplate_id BigInt
  is_sent      Boolean?
  ttemplate    ttemplate @relation(fields: [ttemplate_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_tnotifications_ttemplate")

  @@index([user_id, user_role], map: "idx_notifications_user")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tpayments {
  id           Int       @id @default(autoincrement())
  payment_id   String    @unique @db.VarChar(100)
  tservices_id Int
  amount       Decimal   @db.Decimal(12, 2)
  status       String    @db.VarChar(20)
  created_at   DateTime  @default(now()) @db.Timestamp(6)
  tservices    tservices @relation(fields: [tservices_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model tphotos {
  id           Int       @id @default(autoincrement())
  tservices_id Int
  url          String    @db.VarChar(500)
  is_primary   Boolean?  @default(false)
  tservices    tservices @relation(fields: [tservices_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model tproposals {
  id            Int        @id @default(autoincrement())
  tbids_id      Int
  tservices_id  Int
  tproviders_id Int
  created_at    DateTime   @default(now()) @db.Timestamp(6)
  comment       String?
  status        String     @default("pending") @db.VarChar(20)
  price         Decimal?   @db.Decimal(10, 2)
  tbids         tbids      @relation(fields: [tbids_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tproviders    tproviders @relation(fields: [tproviders_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tservices     tservices  @relation(fields: [tservices_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tproviders {
  id           Int          @id @default(autoincrement())
  tclients_id  Int
  company_name String       @db.VarChar(255)
  phone        String       @db.VarChar(20)
  contact_info Json?
  status       String       @db.VarChar(20)
  created_at   DateTime     @default(now()) @db.Timestamp(6)
  talerts      talerts[]
  tproposals   tproposals[]
  tclients     tclients     @relation(fields: [tclients_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tservices    tservices[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model treviews {
  id           Int       @id @default(autoincrement())
  tservices_id Int
  tclients_id  Int
  rating       Decimal   @db.Decimal(3, 2)
  comment      String?
  created_at   DateTime  @default(now()) @db.Timestamp(6)
  tclients     tclients  @relation(fields: [tclients_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tservices    tservices @relation(fields: [tservices_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([tservices_id, tclients_id])
  @@index([created_at(sort: Desc)], map: "idx_treviews_created")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model tservices {
  id               Int                @id @default(autoincrement())
  name             String             @db.VarChar(255)
  description      String?
  tcategories_id   Int
  price            Decimal            @db.Decimal(12, 2)
  provider_id      Int
  active           Boolean            @default(true)
  status           String             @default("draft") @db.VarChar(20)
  created_at       DateTime           @default(now()) @db.Timestamp(6)
  priority         Int                @default(0) @db.SmallInt
  rating           Decimal?           @default(0.0) @db.Decimal(3, 2)
  rating_count     Int?               @default(0)
  view_count       Int?               @default(0)
  service_options  Json?
  talerts          talerts[]
  tcontacts        tcontacts[]
  tlocations       tlocations[]
  tpayments        tpayments[]
  tphotos          tphotos[]
  tproposals       tproposals[]
  treviews         treviews[]
  tproviders       tproviders         @relation(fields: [provider_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tcategories      tcategories        @relation(fields: [tcategories_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  tservices_clicks tservices_clicks[]

  @@index([tcategories_id], map: "idx_tservices_category")
  @@index([price], map: "idx_tservices_price")
}

model tbids_accomodation_attrs {
  id         Int       @id @default(autoincrement())
  tbids_id   Int
  date_from  DateTime? @db.Date
  date_to    DateTime? @db.Date
  adults_qty Int?      @db.SmallInt
  kids_qty   Int?      @db.SmallInt
  tbids      tbids     @relation(fields: [tbids_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tbids_id], map: "idx_tbids_accomodation_attrs_bid")
}

model tbids_entertainment_attrs {
  id             Int       @id @default(autoincrement())
  tbids_id       Int
  provision_time DateTime? @db.Timestamp(6)
  adults_qty     Int?      @db.SmallInt
  tbids          tbids     @relation(fields: [tbids_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tbids_id], map: "idx_tbids_entertainment_attrs_bid")
}

model tbids_food_attrs {
  id             Int       @id @default(autoincrement())
  tbids_id       Int
  provision_time DateTime? @db.Timestamp(6)
  adults_qty     Int?      @db.SmallInt
  kids_qty       Int?      @db.SmallInt
  tbids          tbids     @relation(fields: [tbids_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tbids_id], map: "idx_tbids_food_attrs_bid")
}

model tbids_health_attrs {
  id             Int       @id @default(autoincrement())
  tbids_id       Int
  provision_time DateTime? @db.Timestamp(6)
  adults_qty     Int?      @db.SmallInt
  tbids          tbids     @relation(fields: [tbids_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tbids_id], map: "idx_tbids_health_attrs_bid")
}

model tbids_package_attrs {
  id             Int       @id @default(autoincrement())
  tbids_id       Int
  provision_time DateTime? @db.Timestamp(6)
  adults_qty     Int?      @db.SmallInt
  kids_qty       Int?      @db.SmallInt
  start_date     DateTime? @db.Date
  nights_from    Int?      @db.SmallInt
  nights_to      Int?      @db.SmallInt
  tbids          tbids     @relation(fields: [tbids_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tbids_id], map: "idx_tbids_package_attrs_bid")
}

model tbids_transport_attrs {
  id             Int       @id @default(autoincrement())
  tbids_id       Int
  provision_time DateTime? @db.Timestamp(6)
  adults_qty     Int?      @db.SmallInt
  kids_qty       Int?      @db.SmallInt
  tbids          tbids     @relation(fields: [tbids_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([tbids_id], map: "idx_tbids_transport_attrs_bid")
}

model ttemplate {
  id             BigInt           @id @default(autoincrement())
  text           String
  action_name    String           @db.VarChar(255)
  tnotifications tnotifications[]
}
