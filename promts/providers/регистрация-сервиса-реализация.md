# План реализации функционала регистрации сервиса

## 1. Создать кнопку перехода на страницу регистрации сервиса

### 1.1 Создать баннер на странице "Каталог" ⏳
- **Компонент**: `ServiceRegistrationBanner`
- **Файл**: `src/components/ServiceRegistrationBanner.tsx`
- **Интеграция**: Добавить в `src/app/catalog/page.tsx`

### 1.2 Создать страницу регистрации сервиса ⏳
- **Страница**: `src/app/services/registration/page.tsx`
- **Компонент**: `ServiceRegistrationPage`
- **Маршрут**: `/services/registration`

## 2. Создать форму регистрации сервиса

### 2.1 Создать основную форму ⏳
- **Компонент**: `ServiceRegistrationForm`
- **Файл**: `src/app/services/registration/_components/ServiceRegistrationForm.tsx`
- **DTO**: `ServiceRegistrationDto` в `src/types/service.ts`
- **Хук**: `useServiceRegistration` в `src/app/services/registration/_hooks/useServiceRegistration.ts`

### 2.2 Реализовать поля сервиса ⏳
- **Компоненты**: 
  - `ServiceNameInput` - поле названия
  - `ServiceDescriptionInput` - поле описания  
  - `ServicePriceInput` - поле цены

### 2.3 Реализовать выбор категории ⏳
- **Компонент**: `CategorySelectionModal`
- **Файл**: `src/app/services/registration/_components/CategorySelectionModal.tsx`
- **Repository метод**: `findAllParentWithChildren()` в `CategoryRepository`
- **Интерфейс**: `ParentCategoryWithChildren` в `src/types/category.ts`

### 2.4 Реализовать поля локации ⏳
- **Компоненты**:
  - `ServiceAddressInput` - поле адреса
  - `ServiceAreaSelect` - выбор зоны
- **Repository**: `AreaRepository` для получения списка зон
- **Интерфейс**: `Area` в `src/types/area.ts`

### 2.5 Реализовать поля контактов ⏳
- **Компоненты**:
  - `ServicePhoneInput` - поле телефона
  - `ServiceTelegramInput` - поле телеграма

### 2.6 Реализовать выбор опций категорий ⏳
- **Компонент**: `CategoryOptionsSelection`
- **Файл**: `src/app/services/registration/_components/CategoryOptionsSelection.tsx`
- **БД таблица**: `tcategories_options`
- **Prisma модель**: `CategoryOption` в `schema.prisma`
- **Repository**: `CategoryOptionsRepository`

## 3. Создать API для сохранения сервиса

### 3.1 Создать endpoint ⏳
- **API Route**: `src/app/api/services/create/route.ts`
- **Модель**: `ServiceCreateModel` в `src/model/ServiceType.ts`
- **Entity**: `CreateServiceEntity` на уровне репозитория

### 3.2 Реализовать сервисный слой ⏳
- **Сервис**: `ServiceRegistrationService`
- **Файл**: `src/service/ServiceRegistrationService.ts`
- **Методы**: `createService(serviceData: ServiceCreateModel): Promise<CreateServiceEntity>`

### 3.3 Реализовать репозиторный слой ⏳
- **Repository**: `ServiceRepository` (расширить существующий)
- **Методы**: `createService(serviceData: ServiceCreateModel): Promise<CreateServiceEntity>`
- **Особенности**: Использовать `prisma include` для сохранения связанных сущностей (tservices, tlocations, tcontacts, tcategories_options)

### 3.4 Создать кнопку отправки ⏳
- **Компонент**: `CreateServiceButton`
- **Интеграция**: В `ServiceRegistrationForm`
- **Состояния**: Загрузка, успех, ошибка

## 4. Интеграция

### 4.1 Интеграция компонентов ⏳
- Связать все компоненты между собой
- Проверить корректность передачи данных

## Статус выполнения задач

**Легенда:**
- ⏳ - В ожидании выполнения
- ✅ - Выполнено
- 🔄 - В процессе выполнения

**Детали реализации:**
*Здесь будут записываться детали по мере выполнения задач*

## Диаграмма взаимодействия компонентов

```
Страница "Каталог"
       │
       ▼
┌─────────────────────────────────┐
│     ServiceRegistrationBanner   │
│         "Подключить бизнес"     │
└─────────────────────────────────┘
       │ (клик)
       ▼
┌─────────────────────────────────┐
│   /services/registration        │
│   ServiceRegistrationPage       │
└─────────────────────────────────┘
       │
       ▼
┌─────────────────────────────────┐
│   ServiceRegistrationForm       │
│   ├─ ServiceNameInput          │
│   ├─ ServiceDescriptionInput   │
│   ├─ ServicePriceInput         │
│   ├─ CategorySelectionModal    │
│   ├─ ServiceAddressInput       │
│   ├─ ServiceAreaSelect         │
│   ├─ ServicePhoneInput         │
│   ├─ ServiceTelegramInput      │
│   ├─ CategoryOptionsSelection  │
│   └─ CreateServiceButton       │
└─────────────────────────────────┘
       │ (отправка формы)
       ▼
┌─────────────────────────────────┐
│   useServiceRegistration Hook   │
└─────────────────────────────────┘
       │
       ▼
┌─────────────────────────────────┐
│   /api/services/create          │
│   ServiceRegistrationService    │
└─────────────────────────────────┘
       │
       ▼
┌─────────────────────────────────┐
│   Repository Layer              │
│   ├─ CategoryRepository        │
│   ├─ AreaRepository            │
│   └─ CategoryOptionsRepository │
└─────────────────────────────────┘
       │
       ▼
┌─────────────────────────────────┐
│   Database                     │
│   ├─ tservices                 │
│   ├─ tcategories               │
│   ├─ tlocations                │
│   ├─ tcontacts                 │
│   ├─ tarea                     │
│   └─ tcategories_options       │
└─────────────────────────────────┘
```

## Структура БД

### Таблица `tcategories_options`
```sql
CREATE TABLE tcategories_options (
  id SERIAL PRIMARY KEY,
  category_id INTEGER REFERENCES tcategories(id),
  name VARCHAR(255) NOT NULL,
  description TEXT
);
```

## Файловая структура
```
src/
├── app/
│   ├── services/
│   │   └── registration/
│   │       ├── _components/
│   │       │   ├── ServiceRegistrationForm.tsx
│   │       │   ├── CategorySelectionModal.tsx
│   │       │   ├── CategoryOptionsSelection.tsx
│   │       │   ├── ServiceNameInput.tsx
│   │       │   ├── ServiceDescriptionInput.tsx
│   │       │   ├── ServicePriceInput.tsx
│   │       │   ├── ServiceAddressInput.tsx
│   │       │   ├── ServiceAreaSelect.tsx
│   │       │   ├── ServicePhoneInput.tsx
│   │       │   ├── ServiceTelegramInput.tsx
│   │       │   └── CreateServiceButton.tsx
│   │       ├── _hooks/
│   │       │   └── useServiceRegistration.ts
│   │       └── page.tsx
│   └── api/
│       └── services/
│           └── create/
│               └── route.ts
├── components/
│   └── ServiceRegistrationBanner.tsx
├── service/
│   └── ServiceRegistrationService.ts
├── repository/
│   └── CategoryOptionsRepository.ts
└── types/
    ├── service.ts
    ├── category.ts
    └── area.ts
```
